{% extends "admin/base.html" %}

{% block title %}Order Detail{% endblock %}

{% block content %}
<div style="margin-bottom: 2rem;">
    <a href="{{ url_for('admin_orders') }}" style="color: #8B7355;">&larr; Back to Orders</a>
</div>

<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
    <h1>Order #{{ order.id }}</h1>
    <span class="badge badge-{{ order.status }}" style="font-size: 1rem;">{{ order.status }}</span>
</div>

<div style="display: grid; grid-template-columns: 2fr 1fr; gap: 2rem; margin-bottom: 2rem;">
    <div style="background-color: white; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
        <h2 style="margin-top: 0;">Customer Information</h2>
        <p><strong>Name:</strong> <a href="{{ url_for('admin_customer_detail', customer_id=customer.id) }}">{{ customer.name }}</a></p>
        <p><strong>Email:</strong> {{ customer.email }}</p>
        <p><strong>Phone:</strong> {{ customer.phone or 'Not provided' }}</p>
        <p><strong>Address:</strong> {{ customer.address or 'Not provided' }}</p>
    </div>
    
    <div style="background-color: white; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
        <h2 style="margin-top: 0;">Order Details</h2>
        <p><strong>Order Date:</strong> {{ order.created_at.strftime('%B %d, %Y %H:%M') }}</p>
        <p><strong>Total:</strong> ${{ "%.2f"|format(order.total_amount) }}</p>
        <p><strong>Payment ID:</strong> {{ order.stripe_payment_id or 'N/A' }}</p>
        
        <form method="POST" action="{{ url_for('admin_update_order_status', order_id=order.id) }}" style="margin-top: 1.5rem;">
            <label for="status" style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Update Status:</label>
            <select name="status" id="status" style="width: 100%; padding: 0.5rem; border: 1px solid #E2E8F0; border-radius: 4px; margin-bottom: 0.5rem;">
                <option value="pending" {% if order.status == 'pending' %}selected{% endif %}>Pending</option>
                <option value="paid" {% if order.status == 'paid' %}selected{% endif %}>Paid</option>
                <option value="processing" {% if order.status == 'processing' %}selected{% endif %}>Processing</option>
                <option value="shipped" {% if order.status == 'shipped' %}selected{% endif %}>Shipped</option>
                <option value="delivered" {% if order.status == 'delivered' %}selected{% endif %}>Delivered</option>
                <option value="cancelled" {% if order.status == 'cancelled' %}selected{% endif %}>Cancelled</option>
            </select>
            <button type="submit" class="btn primary-btn" style="width: 100%;">Update Status</button>
        </form>
    </div>
</div>

<h2>Order Items</h2>
<div class="table-container">
    <table>
        <thead>
            <tr>
                <th>Product</th>
                <th>Quantity</th>
                <th>Price</th>
                <th>Subtotal</th>
            </tr>
        </thead>
        <tbody>
            {% for item in items %}
            <tr>
                <td>{{ item.product_name }}</td>
                <td>{{ item.quantity }}</td>
                <td>${{ "%.2f"|format(item.price_at_purchase) }}</td>
                <td>${{ "%.2f"|format(item.price_at_purchase * item.quantity) }}</td>
            </tr>
            {% endfor %}
            <tr style="font-weight: bold; background-color: #F7FAFC;">
                <td colspan="3" style="text-align: right;">Total:</td>
                <td>${{ "%.2f"|format(order.total_amount) }}</td>
            </tr>
        </tbody>
    </table>
</div>
{% endblock %}
